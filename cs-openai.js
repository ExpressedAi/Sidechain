(()=>{let t;(()=>{const n="__app_sdc",e="production",i=!1;if(t=globalThis[n],t)return;const o={name:n,env:e,get:t=>t in o?o[t]:null,...JSON.parse('{"version":"9.2.1"}')},r=function t(n){const e=n===o,r=e&&i,a={},l=t=>Object.assign(n,t),p=new Proxy(n,{get(i,o){if("assign"===o)return l;if(e&&!String(o).startsWith("$"))return n[o];if(!(o in n)){if(n[o]={},e){const t=s.bind(null,"log",o,!1),e=s.bind(null,"log",o,!0),i=s.bind(null,"warn",o,!1),r=s.bind(null,"warn",o,!0),a=s.bind(null,"error",o,!1),l=s.bind(null,"error",o,!0),p=c.bind(null,o);Object.defineProperties(n[o],{log:{get:()=>t},logDev:{get:()=>e},warn:{get:()=>i},warnDev:{get:()=>r},error:{get:()=>a},errorDev:{get:()=>l},Error:{get:()=>p}})}a[o]=t(n[o]),r&&(globalThis[o]=n[o])}return o in a?a[o]:n[o]},set:(t,e,i)=>(n[e]=i,a[e]=i,r&&(globalThis[e]=n[e]),!0)});return p}(o);function s(t,n,e,...i){if(e)return;const[o,r,s]=function(t){let n=0;t.split("").forEach(((e,i)=>{n=t.charCodeAt(i)+((n<<5)-n)}));return[(16711680&n)>>16,(65280&n)>>8,255&n]}(n);console[t](`%c[${n}]`,`color: rgb(${o}, ${r}, ${s})`,...i)}function c(t,n,...e){return e.length>0&&s("error",t,!1,n,...e),new Error(`[${t}] ${n}`)}globalThis[n]=r,t=r})(),(()=>{const{$ai:n}=t;n.arkoseController={init(){this._isArkoseIframe()&&(this._config=this._getConfig(),this._config&&(this._patchFetch(),this._patchHeadAppendChild(),this._patchEnforcement()))},_isArkoseIframe:()=>window!==window.top&&window.name.startsWith("ae:"),_getConfig(){try{return JSON.parse(window.name.replace("ae:",""))}catch(t){return n.error("failed to parse config",t),null}},_patchFetch(){const t=this._config.siteParam,n=this._config.chatUrl;this._execute(`\n          <script>\n            const fetch0 = window.fetch\n            window.fetch = function (...args) {\n              const opts = args[1]\n              if (\n                typeof opts.body === 'string' &&\n                opts.body.startsWith('${this._config.bodyStartsWith}')\n              ) {\n                opts.body = opts.body.replace(\n                  /&${t}=[^&]+/,\n                  '&${t}=${encodeURIComponent(n)}'\n                )\n              }\n              return fetch0.call(this, ...args)\n            }\n          <\/script>\n        `)},_patchHeadAppendChild(){const t=this._config.dataSiteParam,n=this._config.chatUrl;this._execute(`\n          <script>\n            const appendChild = HTMLElement.prototype.appendChild\n            HTMLElement.prototype.appendChild = function (...args) {\n              const elem = args[0]\n              if (\n                this === document.head &&\n                elem &&\n                elem.tagName === 'SCRIPT' &&\n                elem.src\n              ) {\n                const url = new window.URL(elem.src)\n                const site = url.searchParams.get('${t}')\n                if (site) {\n                  url.searchParams.set('${t}', '${n}')\n                  elem.src = url.href\n                }\n              }\n              return appendChild.call(this, ...args)\n            }\n          <\/script>\n        `)},_patchEnforcement(){if(!this._config.enforcement)return;const t=JSON.stringify(this._config.enforcement);this._execute(`\n          <script>\n            const _sent_ = Symbol('sent')\n            const _isSDK_ = Symbol('isSDK')\n            const enf = JSON.parse('${t}')\n    \n            \n            Object.defineProperty(Object.prototype, enf.$sent, {\n              get () {\n                return this[_sent_]\n              },\n              set (value) {\n                if (value && value[enf.$ef]) {\n                  applyObject(value[enf.$ef], enf.ef)\n                }\n                this[_sent_] = value\n                return true\n              },\n            })\n    \n            \n            Object.defineProperty(Object.prototype, enf.$isSDK, {\n              get () {\n                applyObject(this, enf.config)\n                return this[_isSDK_]\n              },\n              set (value) {\n                this[_isSDK_] = value\n                return true\n              },\n            })\n    \n            function isObject (any) {\n              return Object.prototype.toString.call(any) === '[object Object]'\n            }\n    \n            function applyObject (obj1, obj2) {\n              for (const key in obj2) {\n                if (isObject(obj1[key])) {\n                  applyObject(obj1[key], obj2[key])\n                } else {\n                  obj1[key] = obj2[key]\n                }\n              }\n            }\n          <\/script>\n        `)},_execute(t){t=t.replace("<script>","(() => {").replace("<\/script>","})()");const n=document.createElement("div");n.setAttribute("onreset",t),n.dispatchEvent(new Event("reset"))}}})(),(()=>{const{$ai:n,$bus:e}=t;n.controller={init(){n.arkoseController.init(),this._closeAuthPopupOnSuccess()},async _closeAuthPopupOnSuccess(){const t=await e.getWindowId();await e.send("openai.isAuthPopup",t)&&(await this._waitForChatInterface(),await this._waitForLogin(),setTimeout((()=>window.close()),1500))},async _waitForChatInterface(){await new Promise((t=>{const n=setInterval((()=>{!!document.querySelector("#__next main")&&(clearInterval(n),t())}),50)}))},async _waitForLogin(){await new Promise((t=>{setTimeout((async()=>{try{await this._waitNoMutations();const n="https://chatgpt.com/api/auth/session",e=await fetch(n,{credentials:"include"});(await e.json()).error&&await this._waitForLogin(),t()}catch(t){console.error("failed to fetch session",t)}}),1500)}))},async _waitNoMutations(t=1e3){await new Promise((n=>{const e=()=>{n(),o.disconnect()};let i=setTimeout(e,t);const o=new MutationObserver((()=>{clearTimeout(i),i=setTimeout(e,t)}));o.observe(document.documentElement,{attributes:!0,childList:!0,subtree:!0})}))}}})(),(()=>{const{$startup:n,$ai:e}=t;n.openaiController={init(){e.controller.init()}},n.openaiController.init()})()})();