(()=>{let A;(()=>{const e="__app_sdc",t="production",i=!1;if(A=globalThis[e],A)return;const n={name:e,env:t,get:A=>A in n?n[A]:null,...JSON.parse('{"version":"9.2.1"}')},r=function A(e){const t=e===n,r=t&&i,a={},c=A=>Object.assign(e,A),l=new Proxy(e,{get(i,n){if("assign"===n)return c;if(t&&!String(n).startsWith("$"))return e[n];if(!(n in e)){if(e[n]={},t){const A=s.bind(null,"log",n,!1),t=s.bind(null,"log",n,!0),i=s.bind(null,"warn",n,!1),r=s.bind(null,"warn",n,!0),a=s.bind(null,"error",n,!1),c=s.bind(null,"error",n,!0),l=o.bind(null,n);Object.defineProperties(e[n],{log:{get:()=>A},logDev:{get:()=>t},warn:{get:()=>i},warnDev:{get:()=>r},error:{get:()=>a},errorDev:{get:()=>c},Error:{get:()=>l}})}a[n]=A(e[n]),r&&(globalThis[n]=e[n])}return n in a?a[n]:e[n]},set:(A,t,i)=>(e[t]=i,a[t]=i,r&&(globalThis[t]=e[t]),!0)});return l}(n);function s(A,e,t,...i){if(t)return;const[n,r,s]=function(A){let e=0;A.split("").forEach(((t,i)=>{e=A.charCodeAt(i)+((e<<5)-e)}));return[(16711680&e)>>16,(65280&e)>>8,255&e]}(e);console[A](`%c[${e}]`,`color: rgb(${n}, ${r}, ${s})`,...i)}function o(A,e,...t){return t.length>0&&s("error",A,!1,e,...t),new Error(`[${A}] ${e}`)}globalThis[e]=r,A=r})(),(()=>{function e(A,e,t,i){return new(t||(t=Promise))((function(n,r){function s(A){try{a(i.next(A))}catch(A){r(A)}}function o(A){try{a(i.throw(A))}catch(A){r(A)}}function a(A){var e;A.done?n(A.value):(e=A.value,e instanceof t?e:new t((function(A){A(e)}))).then(s,o)}a((i=i.apply(A,e||[])).next())}))}"function"==typeof SuppressedError&&SuppressedError;var t,i=class{constructor(){this.mutex=Promise.resolve()}lock(){let A=()=>{};return this.mutex=this.mutex.then((()=>new Promise(A))),new Promise((e=>{A=e}))}dispatch(A){return e(this,void 0,void 0,(function*(){const e=yield this.lock();try{return yield Promise.resolve(A())}finally{e()}}))}},n="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:global,r=null!==(t=n.Buffer)&&void 0!==t?t:null,s=n.TextEncoder?new n.TextEncoder:null;function o(A,e){return(15&A)+(A>>6|A>>3&8)<<4|(15&e)+(e>>6|e>>3&8)}var a="a".charCodeAt(0)-10,c="0".charCodeAt(0);function l(A,e,t){let i=0;for(let n=0;n<t;n++){let t=e[n]>>>4;A[i++]=t>9?t+a:t+c,t=15&e[n],A[i++]=t>9?t+a:t+c}return String.fromCharCode.apply(null,A)}var h=null!==r?A=>{if("string"==typeof A){const e=r.from(A,"utf8");return new Uint8Array(e.buffer,e.byteOffset,e.length)}if(r.isBuffer(A))return new Uint8Array(A.buffer,A.byteOffset,A.length);if(ArrayBuffer.isView(A))return new Uint8Array(A.buffer,A.byteOffset,A.byteLength);throw new Error("Invalid data type!")}:A=>{if("string"==typeof A)return s.encode(A);if(ArrayBuffer.isView(A))return new Uint8Array(A.buffer,A.byteOffset,A.byteLength);throw new Error("Invalid data type!")},I="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",g=new Uint8Array(256);for(let A=0;A<I.length;A++)g[I.charCodeAt(A)]=A;function B(A){const e=function(A){let e=Math.floor(.75*A.length);const t=A.length;return"="===A[t-1]&&(e-=1,"="===A[t-2]&&(e-=1)),e}(A),t=A.length,i=new Uint8Array(e);let n=0;for(let e=0;e<t;e+=4){const t=g[A.charCodeAt(e)],r=g[A.charCodeAt(e+1)],s=g[A.charCodeAt(e+2)],o=g[A.charCodeAt(e+3)];i[n]=t<<2|r>>4,n+=1,i[n]=(15&r)<<4|s>>2,n+=1,i[n]=(3&s)<<6|63&o,n+=1}return i}var u=16384,Q=new i,w=new Map;function C(A,t){return e(this,void 0,void 0,(function*(){let i=null,n=null,r=!1;if("undefined"==typeof WebAssembly)throw new Error("WebAssembly is not supported in this environment!");const s=()=>new DataView(i.exports.memory.buffer).getUint32(i.exports.STATE_SIZE,!0),a=Q.dispatch((()=>e(this,void 0,void 0,(function*(){if(!w.has(A.name)){const e=B(A.data),t=WebAssembly.compile(e);w.set(A.name,t)}const e=yield w.get(A.name);i=yield WebAssembly.instantiate(e,{})})))),c=(A=null)=>{r=!0,i.exports.Hash_Init(A)},I=A=>{if(!r)throw new Error("update() called before init()");(A=>{let e=0;for(;e<A.length;){const t=A.subarray(e,e+u);e+=t.length,n.set(t),i.exports.Hash_Update(t.length)}})(h(A))},g=new Uint8Array(2*t),C=(A,e=null)=>{if(!r)throw new Error("digest() called before init()");return r=!1,i.exports.Hash_Final(e),"binary"===A?n.slice(0,t):l(g,n,t)},E=A=>"string"==typeof A?A.length<4096:A.byteLength<u;let f=E;switch(A.name){case"argon2":case"scrypt":f=()=>!0;break;case"blake2b":case"blake2s":f=(A,e)=>e<=512&&E(A);break;case"blake3":f=(A,e)=>0===e&&E(A);break;case"xxhash64":case"xxhash3":case"xxhash128":f=()=>!1}return yield(()=>e(this,void 0,void 0,(function*(){i||(yield a);const A=i.exports.Hash_GetBuffer(),e=i.exports.memory.buffer;n=new Uint8Array(e,A,u)})))(),{getMemory:()=>n,writeMemory:(A,e=0)=>{n.set(A,e)},getExports:()=>i.exports,setMemorySize:A=>{i.exports.Hash_SetMemorySize(A);const e=i.exports.Hash_GetBuffer(),t=i.exports.memory.buffer;n=new Uint8Array(t,e,A)},init:c,update:I,digest:C,save:()=>{if(!r)throw new Error("save() can only be called after init() and before digest()");const e=i.exports.Hash_GetState(),t=s(),n=i.exports.memory.buffer,a=new Uint8Array(n,e,t),c=new Uint8Array(4+t);return function(A,e){const t=e.length>>1;for(let i=0;i<t;i++){const t=i<<1;A[i]=o(e.charCodeAt(t),e.charCodeAt(t+1))}}(c,A.hash),c.set(a,4),c},load:e=>{if(!(e instanceof Uint8Array))throw new Error("load() expects an Uint8Array generated by save()");const t=i.exports.Hash_GetState(),n=s(),a=4+n,c=i.exports.memory.buffer;if(e.length!==a)throw new Error(`Bad state length (expected ${a} bytes, got ${e.length})`);if(!function(A,e){if(A.length!==2*e.length)return!1;for(let t=0;t<e.length;t++){const i=t<<1;if(e[t]!==o(A.charCodeAt(i),A.charCodeAt(i+1)))return!1}return!0}(A.hash,e.subarray(0,4)))throw new Error("This state was written by an incompatible hash implementation");const l=e.subarray(4);new Uint8Array(c,t,n).set(l),r=!0},calculate:(A,e=null,r=null)=>{if(!f(A,e))return c(e),I(A),C("hex",r);const s=h(A);return n.set(s),i.exports.Hash_Calculate(s.length,e,r),l(g,n,t)},hashLength:t}}))}new i,new i,new DataView(new ArrayBuffer(4)),new i,new i,new i,new i,new i,new i,new i;var E={name:"sha3",data:"AGFzbQEAAAABFARgAAF/YAF/AGACf38AYAN/f38AAwgHAAEBAgEAAwUEAQECAgYOAn8BQZCNBQt/AEGACAsHcAgGbWVtb3J5AgAOSGFzaF9HZXRCdWZmZXIAAAlIYXNoX0luaXQAAQtIYXNoX1VwZGF0ZQACCkhhc2hfRmluYWwABA1IYXNoX0dldFN0YXRlAAUOSGFzaF9DYWxjdWxhdGUABgpTVEFURV9TSVpFAwEKqBwHBQBBgAoL1wMAQQBCADcDgI0BQQBCADcD+IwBQQBCADcD8IwBQQBCADcD6IwBQQBCADcD4IwBQQBCADcD2IwBQQBCADcD0IwBQQBCADcDyIwBQQBCADcDwIwBQQBCADcDuIwBQQBCADcDsIwBQQBCADcDqIwBQQBCADcDoIwBQQBCADcDmIwBQQBCADcDkIwBQQBCADcDiIwBQQBCADcDgIwBQQBCADcD+IsBQQBCADcD8IsBQQBCADcD6IsBQQBCADcD4IsBQQBCADcD2IsBQQBCADcD0IsBQQBCADcDyIsBQQBCADcDwIsBQQBCADcDuIsBQQBCADcDsIsBQQBCADcDqIsBQQBCADcDoIsBQQBCADcDmIsBQQBCADcDkIsBQQBCADcDiIsBQQBCADcDgIsBQQBCADcD+IoBQQBCADcD8IoBQQBCADcD6IoBQQBCADcD4IoBQQBCADcD2IoBQQBCADcD0IoBQQBCADcDyIoBQQBCADcDwIoBQQBCADcDuIoBQQBCADcDsIoBQQBCADcDqIoBQQBCADcDoIoBQQBCADcDmIoBQQBCADcDkIoBQQBCADcDiIoBQQBCADcDgIoBQQBBwAwgAEEBdGtBA3Y2AoyNAUEAQQA2AoiNAQuMAwEIfwJAQQAoAoiNASIBQQBIDQBBACABIABqQQAoAoyNASICcDYCiI0BAkACQCABDQBBgAohAwwBCwJAIAIgAWsiBCAAIAQgAEkbIgNFDQAgA0EDcSEFQQAhBgJAIANBBEkNACABQYCKAWohByADQXxxIQhBACEGA0AgByAGaiIDQcgBaiAGQYAKai0AADoAACADQckBaiAGQYEKai0AADoAACADQcoBaiAGQYIKai0AADoAACADQcsBaiAGQYMKai0AADoAACAIIAZBBGoiBkcNAAsLIAVFDQAgAUHIiwFqIQMDQCADIAZqIAZBgApqLQAAOgAAIAZBAWohBiAFQX9qIgUNAAsLIAQgAEsNAUHIiwEgAhADIAAgBGshACAEQYAKaiEDCwJAIAAgAkkNAANAIAMgAhADIAMgAmohAyAAIAJrIgAgAk8NAAsLIABFDQBBACECQcgBIQYDQCAGQYCKAWogAyAGakG4fmotAAA6AAAgBkEBaiEGIAAgAkEBaiICQf8BcUsNAAsLC+QLAS1+IAApA0AhAkEAKQPAigEhAyAAKQM4IQRBACkDuIoBIQUgACkDMCEGQQApA7CKASEHIAApAyghCEEAKQOoigEhCSAAKQMgIQpBACkDoIoBIQsgACkDGCEMQQApA5iKASENIAApAxAhDkEAKQOQigEhDyAAKQMIIRBBACkDiIoBIREgACkDACESQQApA4CKASETQQApA8iKASEUAkACQCABQcgASw0AQQApA9CKASEVQQApA+CKASEWQQApA9iKASEXDAELQQApA+CKASAAKQNghSEWQQApA9iKASAAKQNYhSEXQQApA9CKASAAKQNQhSEVIBQgACkDSIUhFCABQekASQ0AQQBBACkD6IoBIAApA2iFNwPoigFBAEEAKQPwigEgACkDcIU3A/CKAUEAQQApA/iKASAAKQN4hTcD+IoBQQBBACkDgIsBIAApA4ABhTcDgIsBIAFBiQFJDQBBAEEAKQOIiwEgACkDiAGFNwOIiwELIAMgAoUhGCAFIASFIRkgByAGhSEHIAkgCIUhCCALIAqFIRogDSAMhSEJIA8gDoUhCiARIBCFIQsgEyAShSEMQQApA7iLASESQQApA5CLASETQQApA+iKASEbQQApA6CLASEcQQApA/iKASENQQApA7CLASEdQQApA4iLASEOQQApA8CLASEPQQApA5iLASEeQQApA/CKASEQQQApA6iLASERQQApA4CLASEfQcB+IQADQCAaIAcgC4UgF4UgH4UgEYVCAYmFIBSFIBCFIB6FIA+FIQIgDCAZIAqFIBaFIA6FIB2FQgGJhSAIhSAVhSANhSAchSIDIAeFISAgCSAIIAyFIBWFIA2FIByFQgGJhSAYhSAbhSAThSAShSIEIA+FISEgGCAKIBQgGoUgEIUgHoUgD4VCAYmFIBmFIBaFIA6FIB2FIgWFQjeJIiIgCyAYIAmFIBuFIBOFIBKFQgGJhSAHhSAXhSAfhSARhSIGIAqFQj6JIiNCf4WDIAMgEYVCAokiJIUhDyANIAKFQimJIiUgBCAQhUIniSImQn+FgyAihSERIBIgBYVCOIkiEiAGIA6FQg+JIidCf4WDIAMgF4VCCokiKIUhDiAEIBqFQhuJIikgKCAIIAKFQiSJIipCf4WDhSENIAYgGYVCBokiKyADIAuFQgGJIixCf4WDIBwgAoVCEokiLYUhECArIAQgHoVCCIkiLiAbIAWFQhmJIhtCf4WDhSEXIAYgHYVCPYkiGSAEIBSFQhSJIgQgCSAFhUIciSIIQn+Fg4UhFCAIIBlCf4WDIAMgH4VCLYkiA4UhGCAZIANCf4WDIBUgAoVCA4kiCYUhGSAEIAMgCUJ/hYOFIQcgCSAEQn+FgyAIhSEIIAwgAoUiAiAhQg6JIgNCf4WDIBMgBYVCFYkiBIUhCSAGIBaFQiuJIgUgAyAEQn+Fg4UhCiAEIAVCf4WDICBCLIkiBIUhCyAAQdAJaikDACAFIARCf4WDhSAChSEMICcgKEJ/hYMgKoUiBSEfIAMgBCACQn+Fg4UiAiEaICogKUJ/hYMgEoUiAyEeIC0gLkJ/hYMgG4UiBCEWICYgJCAlQn+Fg4UiBiEdIBsgK0J/hYMgLIUiKCEVICMgJiAiQn+Fg4UiIiEcIC4gLCAtQn+Fg4UiJiEbICcgKSASQn+Fg4UiJyETICMgJEJ/hYMgJYUiIyESIABBCGoiAA0AC0EAIBE3A6iLAUEAIAU3A4CLAUEAIBc3A9iKAUEAIAc3A7CKAUEAIAs3A4iKAUEAIA83A8CLAUEAIAM3A5iLAUEAIBA3A/CKAUEAIBQ3A8iKAUEAIAI3A6CKAUEAIAY3A7CLAUEAIA43A4iLAUEAIAQ3A+CKAUEAIBk3A7iKAUEAIAo3A5CKAUEAICI3A6CLAUEAIA03A/iKAUEAICg3A9CKAUEAIAg3A6iKAUEAIAw3A4CKAUEAICM3A7iLAUEAICc3A5CLAUEAICY3A+iKAUEAIBg3A8CKAUEAIAk3A5iKAQv4AgEFf0HkAEEAKAKMjQEiAUEBdmshAgJAQQAoAoiNASIDQQBIDQAgASEEAkAgASADRg0AIANByIsBaiEFQQAhAwNAIAUgA2pBADoAACADQQFqIgMgAUEAKAKIjQEiBGtJDQALCyAEQciLAWoiAyADLQAAIAByOgAAIAFBx4sBaiIDIAMtAABBgAFyOgAAQciLASABEANBAEGAgICAeDYCiI0BCwJAIAJBBEkNACACQQJ2IgNBA3EhBUEAIQQCQCADQX9qQQNJDQAgA0H8////A3EhAUEAIQNBACEEA0AgA0GACmogA0GAigFqKAIANgIAIANBhApqIANBhIoBaigCADYCACADQYgKaiADQYiKAWooAgA2AgAgA0GMCmogA0GMigFqKAIANgIAIANBEGohAyABIARBBGoiBEcNAAsLIAVFDQAgBUECdCEBIARBAnQhAwNAIANBgApqIANBgIoBaigCADYCACADQQRqIQMgAUF8aiIBDQALCwsGAEGAigEL0QYBA39BAEIANwOAjQFBAEIANwP4jAFBAEIANwPwjAFBAEIANwPojAFBAEIANwPgjAFBAEIANwPYjAFBAEIANwPQjAFBAEIANwPIjAFBAEIANwPAjAFBAEIANwO4jAFBAEIANwOwjAFBAEIANwOojAFBAEIANwOgjAFBAEIANwOYjAFBAEIANwOQjAFBAEIANwOIjAFBAEIANwOAjAFBAEIANwP4iwFBAEIANwPwiwFBAEIANwPoiwFBAEIANwPgiwFBAEIANwPYiwFBAEIANwPQiwFBAEIANwPIiwFBAEIANwPAiwFBAEIANwO4iwFBAEIANwOwiwFBAEIANwOoiwFBAEIANwOgiwFBAEIANwOYiwFBAEIANwOQiwFBAEIANwOIiwFBAEIANwOAiwFBAEIANwP4igFBAEIANwPwigFBAEIANwPoigFBAEIANwPgigFBAEIANwPYigFBAEIANwPQigFBAEIANwPIigFBAEIANwPAigFBAEIANwO4igFBAEIANwOwigFBAEIANwOoigFBAEIANwOgigFBAEIANwOYigFBAEIANwOQigFBAEIANwOIigFBAEIANwOAigFBAEHADCABQQF0a0EDdjYCjI0BQQBBADYCiI0BIAAQAkHkAEEAKAKMjQEiAEEBdmshAwJAQQAoAoiNASIBQQBIDQAgACEEAkAgACABRg0AIAFByIsBaiEFQQAhAQNAIAUgAWpBADoAACABQQFqIgEgAEEAKAKIjQEiBGtJDQALCyAEQciLAWoiASABLQAAIAJyOgAAIABBx4sBaiIBIAEtAABBgAFyOgAAQciLASAAEANBAEGAgICAeDYCiI0BCwJAIANBBEkNACADQQJ2IgFBA3EhBUEAIQQCQCABQX9qQQNJDQAgAUH8////A3EhAEEAIQFBACEEA0AgAUGACmogAUGAigFqKAIANgIAIAFBhApqIAFBhIoBaigCADYCACABQYgKaiABQYiKAWooAgA2AgAgAUGMCmogAUGMigFqKAIANgIAIAFBEGohASAAIARBBGoiBEcNAAsLIAVFDQAgBUECdCEAIARBAnQhAQNAIAFBgApqIAFBgIoBaigCADYCACABQQRqIQEgAEF8aiIADQALCwsL2AEBAEGACAvQAZABAAAAAAAAAAAAAAAAAAABAAAAAAAAAIKAAAAAAAAAioAAAAAAAIAAgACAAAAAgIuAAAAAAAAAAQAAgAAAAACBgACAAAAAgAmAAAAAAACAigAAAAAAAACIAAAAAAAAAAmAAIAAAAAACgAAgAAAAACLgACAAAAAAIsAAAAAAACAiYAAAAAAAIADgAAAAAAAgAKAAAAAAACAgAAAAAAAAIAKgAAAAAAAAAoAAIAAAACAgYAAgAAAAICAgAAAAAAAgAEAAIAAAAAACIAAgAAAAIA=",hash:"f2f6f5b2"},f=new i,d=null;function p(A){return[224,256,384,512].includes(A)?null:new Error("Invalid variant! Valid values: 224, 256, 384, 512")}new i,new i,new i,new i,new i,new i,new i,new ArrayBuffer(8),new i,new ArrayBuffer(8),new i,new ArrayBuffer(8),new i,new i,new i,A.$hashWasm={sha3:function(A,t=512){if(p(t))return Promise.reject(p(t));const i=t/8;if(null===d||d.hashLength!==i)return function(A,t,i){return e(this,void 0,void 0,(function*(){const e=yield A.lock(),n=yield C(t,i);return e(),n}))}(f,E,i).then((e=>(d=e).calculate(A,t,6)));try{const e=d.calculate(A,t,6);return Promise.resolve(e)}catch(A){return Promise.reject(A)}}}})(),(()=>{const{$ai:e,$utils:t,$bus:i,$hashWasm:n}=A;e.arkoseController={init(){this._arkose=null,this._setupPromise=null,this._firstTimeFetchToken=!0,this._fetchTokenPromise=t.createPromise(),i.on("ai.retrieveArkoseToken",this._retrieveArkoseToken,this),i.on("ai.generateProofToken",this._generateProofToken,this)},async _retrieveArkoseToken({dx:A,config:e,accessToken:i}){await this._ensureSetup(e,i),this._arkose.setConfig({[e.dataKey]:{[e.blobKey]:A}}),this._firstTimeFetchToken?(this._arkose.run(),this._firstTimeFetchToken=!1):(this._fetchTokenPromise=t.createPromise(),this._arkose.reset());const n=setTimeout((()=>this._fetchTokenPromise.reject("Token fetching timed out")),e.tokenFetchTimeout),r=await this._fetchTokenPromise;return clearTimeout(n),r},async _generateProofToken({seed:A,difficulty:e,scripts:i,dpl:r}){const s=A=>{const e=JSON.stringify(A);return btoa(String.fromCharCode(...(new TextEncoder).encode(e)))},o=performance.now(),a=Object.keys(Object.getPrototypeOf(navigator)),c=t.pickRandom(a),l=[navigator.hardwareConcurrency+screen.width+screen.height,(new Date).toString(),performance.memory.jsHeapSizeLimit,Math.random(),navigator.userAgent,t.pickRandom(i),r,navigator.language,navigator.languages.join(","),Math.random(),`${c}-${navigator[c]}`,t.pickRandom(Object.keys(document)),t.pickRandom(Object.keys(window)),performance.now(),crypto.randomUUID()];for(let i=1;i<1e5;i++){i%1e3==0&&await t.sleep(150),l[3]=i,l[9]=Math.round(performance.now()-o);const r=s(l);if((await n.sha3(`${A}${r}`)).substring(0,e.length)<=e)return r}return null},async _ensureSetup(A,e){if(this._setupPromise)return this._setupPromise;if(this._setupPromise=t.createPromise(),this._patchArkoseIframe(A),window.useArkoseSetupEnforcement=async e=>{e.setConfig({...A.params,[A.selectorKey]:"#challenge",[A.onErrorKey]:A=>{this._fetchTokenPromise.reject(A)},[A.onCompletedKey]:e=>{this._fetchTokenPromise.resolve(e[A.resultTokenKey])}}),this._arkose=e},!document.getElementById("challenge")){const A=document.createElement("div");A.id="challenge",document.body.appendChild(A)}const i=document.createElement("script"),n=A.script;Object.entries(n).forEach((([A,e])=>i.setAttribute(A,e))),document.head.appendChild(i),await new Promise(((e,t)=>{const n=setTimeout((()=>{t("Script loading timed out")}),A.scriptLoadTimeout);i.onload=()=>{clearTimeout(n),i.setAttribute("data-status","loaded"),e()},i.onerror=()=>{clearTimeout(n),i.setAttribute("data-status","failed"),t("Script loading failed")}})),this._setupPromise.resolve()},_patchArkoseIframe(A){const e=HTMLElement.prototype.appendChild;HTMLElement.prototype.appendChild=function(...i){const n=i[0];return n&&t.is.string(n.tagName)&&"iframe"===n.tagName.toLowerCase()&&n.src.startsWith(A.iframeUrl)&&n.setAttribute("name",`ae:${JSON.stringify(A)}`),e.call(this,...i)}}}})(),(()=>{const{$ai:e}=A;e.controller={init(){e.arkoseController.init()}}})(),(()=>{const{$utils:e}=A;e.createPromise=()=>{let A=null,e=null;const t=new Promise(((t,i)=>{A=t,e=i}));return Object.defineProperty(t,"resolve",{get:()=>A}),Object.defineProperty(t,"reject",{get:()=>e}),t}})(),(()=>{const{$utils:e}=A;e.is={null:A=>null===A,defined:A=>void 0!==A,undefined:A=>void 0===A,nil:A=>null==A,boolean:A=>"boolean"==typeof A,number:A=>"number"==typeof A,string:A=>"string"==typeof A,symbol:A=>"symbol"==typeof A,function:A=>"function"==typeof A,map:A=>A instanceof Map,set:A=>A instanceof Set,url:A=>A instanceof URL,blob:A=>A instanceof Blob,file:A=>A instanceof File,error:A=>A instanceof Error,regexp:A=>A instanceof RegExp,array:A=>Array.isArray(A),object:A=>"[object Object]"===Object.prototype.toString.call(A),nan:A=>Number.isNaN(A),nonPrimitive:A=>e.is.object(A)||e.is.array(A),numeric:A=>!e.is.nan(Number(A)),empty:A=>!!e.is.nil(A)||(e.is.array(A)?0===A.length:e.is.object(A)?0===Object.keys(A).length:!!e.is.string(A)&&0===A.trim().length)}})(),(()=>{const{$utils:e,$bus:t}=A;e.objectUrl={create(A,i=!1){if(!URL.createObjectURL)return t.send("utils.objectUrl.create",A,i);const n=URL.createObjectURL(A);if(i){const A=e.is.number(i)?i:6e4;setTimeout((()=>URL.revokeObjectURL(n)),A)}return n},revoke(A){if(!URL.revokeObjectURL)return t.send("utils.objectUrl.revoke",A);URL.revokeObjectURL(A)}}})(),(()=>{const{$utils:e}=A;e.pickRandom=A=>A[Math.floor(Math.random()*A.length)]})(),Array.prototype.toReversed&&(Array.prototype.toReversed=function(){return[...this].reverse()}),Array.prototype.at||(Array.prototype.at=function(A){return this[A>=0?A:this.length+A]}),Array.prototype.findLastIndex||(Array.prototype.findLastIndex=function(A,e){for(let t=this.length-1;t>=0;t--)if(A.call(e,this[t],t,this))return t;return-1}),String.prototype.replaceAll&&/\{\s+\[native code]/.test(Function.prototype.toString.call(String.prototype.replaceAll))||(String.prototype.replaceAll=function(A,e){return"[object regexp]"===Object.prototype.toString.call(A).toLowerCase()?this.replace(A,e):this.replace(new RegExp(A,"g"),e)}),(()=>{const{$utils:e}=A;e.sleep=async A=>new Promise((e=>{setTimeout(e,A)}))})(),(()=>{const{$utils:e}=A;e.waitFor=async(A,{interval:t=100,timeout:i=6e4}={})=>{if(i<=0)throw new Error("$utils.waitFor: timeout exceeded");const n=Date.now(),r=await A();if(r)return r;await e.sleep(t);const s=Date.now()-n;return e.waitFor(A,{interval:t,timeout:i-s})}})(),(()=>{const{$bus:e,$env:t,$utils:i}=A;{const e=A.get("$bus").controller?._njOnMsg;e&&window.removeEventListener("message",e)}e.controller={init(){e.on=this.on.bind(this),e.off=this.off.bind(this),e.once=this.once.bind(this),e.send=this._wrapThrowIfError(this.send),e.call=this._wrapThrowIfError(this.call),e.poll=this.poll.bind(this),e.getTabId=this.getTabId.bind(this),e.getWindowId=this.getWindowId.bind(this),this._locus=t.getLocus(),this._serialize=this._serialize.bind(this),this._handlers={},this._is("pp")?this._setupPp():this._is("bg")?(this._blobs={},this._channel=new BroadcastChannel("bus.channel"),this._setupBg()):this._is("cs")?this._setupCs():this._is("nj")?this._setupNj():this._is("os")?(e.setIframe=A=>this._iframe=A,this._iframe=null,this._channel=new BroadcastChannel("bus.channel"),this._setupOs()):this._is("oi")&&this._setupOi()},on(A,e,t=null){this._on(A,null,e,t)},off(A,e=null){this._off(A,null,e)},once(A,e){const t=async(...i)=>(this.off(A,t),await e(...i));this.on(A,t)},async send(A,...t){if(!i.is.nan(Number(A))){const e=Number(A);return A=t[0],t=t.slice(1),await this._sendToTab(e,A,...t)}if(this._is("pp"))return await this._sendToExt(A,...t);if(this._is("nj"))return await this._sendToPage(A,...t);if(this._is("oi"))return await this._sendToParent(A,...t);if(this._is("bg","cs","os"))return await this._pick([this._sendToExt(A,...t),this._callHandlers({name:A,args:t},(A=>A.proxy))]);if(this._is("fg")){if("store.actions"===A)return;if("idb.change"===A)return;e.log(A,...t)}},async call(A,...e){return this._callHandlers({name:A,args:e},(A=>!A.proxy))},async poll(A,...e){return await i.waitFor((()=>this.send(A,...e)))},async getTabId(){if(this._is("bg"))return null;const{tabId:A}=await this.send("bus.getTabData");return A},async getWindowId(){if(this._is("bg"))return null;const{windowId:A}=await this.send("bus.getTabData");return A},_on(A,e,t,i=null){this._handlers[A]||(this._handlers[A]=[]),this._is("cs","nj","oi")&&0===this._handlers[A].length&&this._sendToProxier("bus.proxy",A,!0);const n={fn:t,name:A};e&&(n.proxy=e),i&&(n.this=i),this._handlers[A].push(n)},_off(A,e=null,t=null){this._handlers[A]&&(this._handlers[A]=this._handlers[A].filter((A=>{const i=!t||t===A.fn,n=e===(A.proxy||null);return!i||!n})),this._is("cs","nj","oi")&&0===this._handlers[A].length&&this._sendToProxier("bus.proxy",A,!1))},_setupPp(){},_setupBg(){},_setupCs(){},_setupNj(){},_setupOs(){},_setupOi(){window.addEventListener("message",(async({data:A})=>{if(!A?.$bus)return;const e=await this._callHandlers(A);window.parent.postMessage({resId:A.reqId,result:e},"*")}))},async _sendToExt(A,...t){const i={$bus:!0,name:A,argsStr:this._serialize(t)},n=await new Promise((A=>{try{chrome.runtime.sendMessage(i,(e=>{chrome.runtime.lastError?A(null):A(e)}))}catch(t){if("Extension context invalidated."===t.message)return;e.error(t),A(null)}}));return await this._deserialize(n)},async _sendToTab(A,e,...t){if(!chrome.tabs?.sendMessage)return await this.send("bus.sendToTab",A,e,...t);const i={$bus:!0,name:e,argsStr:this._serialize(t)},n=await new Promise((e=>{chrome.tabs.sendMessage(A,i,(A=>{chrome.runtime.lastError?e(null):e(A)}))}));return await this._deserialize(n)},async _sendToPage(A,...e){const t=this._generateId(),i={$bus:!0,name:A,args:e,reqId:t,locus:this._locus};return window.postMessage(i,"*"),await this._waitForResponseMessage(t)},async _sendToIframe(A,...e){if(!this._iframe)return null;const t=this._generateId(),i={$bus:!0,name:A,args:e,reqId:t};return this._iframe.contentWindow.postMessage(i,"*"),await this._waitForResponseMessage(t)},async _sendToParent(A,...e){const t=this._generateId(),i={$bus:!0,name:A,args:e,reqId:t};return parent.postMessage(i,"*"),await this._waitForResponseMessage(t)},async _sendToProxier(A,...e){return this._is("cs")?await this._sendToExt(A,...e):this._is("nj")?await this._sendToPage(A,...e):this._is("oi")?await this._sendToParent(A,...e):void 0},_waitForResponseMessage:async A=>await new Promise((e=>{const t=({data:i})=>{!(!i||i.resId!==A)&&(window.removeEventListener("message",t),e(i.result))};window.addEventListener("message",t)})),_callHandlers({name:A,args:t,argsStr:i},n=null){let r=this._handlers[A];return r?(n&&(r=r.filter(n)),0===r.length?null:new Promise((async A=>{i&&(t=await this._deserialize(i));A(await this._pick(r.map((async A=>{try{return await A.fn.call(A.this,...t)}catch(t){return e.error(`failed to handle "${A.name}".`,t),t}}))))}))):null},_serialize(A){return i.is.nil(A)?null:JSON.stringify(A,((A,e)=>{if(i.is.blob(e)){if(this._is("bg")){const A=this._generateId();return this._blobs[A]=e,`bus.blob.${A}`}return`bus.blob.${i.objectUrl.create(e,!0)}`}return i.is.error(e)?`bus.error.${e.message}`:e}))},async _deserialize(A){if(!i.is.string(A))return null;const e=new Map,t=JSON.parse(A,((A,t)=>{const n=i.is.string(t);return n&&t.startsWith("bus.blob.")?(e.set(t,t.slice("bus.blob.".length)),t):n&&t.startsWith("bus.error.")?new Error(t.slice("bus.error.".length)):t}));return await Promise.all([...e.keys()].map((async A=>{let t;const i=e.get(A);t=i.startsWith("blob:")?i:await this._sendToExt("bus.blobIdToObjectUrl",i);const n=await fetch(t).then((A=>A.blob()));e.set(A,n)}))),this._applyBlobs(t,e)},_applyBlobs(A,e){if(e.has(A))return e.get(A);if(i.is.array(A)||i.is.object(A))for(const t in A)A[t]=this._applyBlobs(A[t],e);return A},async _blobIdToObjectUrl(A){},async _blobToObjectUrl(A){},_is(...A){return A.includes(this._locus)},_generateId:()=>`bus-${Date.now()}-${Math.random().toString(36).slice(2)}`,_wrapThrowIfError(A){return async(...e)=>{const t=await A.call(this,...e);if(i.is.error(t))throw t;return t}},_pick:async(A=[])=>0===A.length?null:await new Promise((e=>{let t=0;A.forEach((async n=>{const r=await n;return i.is.nil(r)?t===A.length-1?e(null):void t++:e(r)}))}))}})(),(()=>{const{$env:e}=A;e.getLocus=()=>{if("undefined"==typeof location)return"el";const{protocol:A,host:e,pathname:t,href:i}=location;return"https://harpa.ai/oi"===i||"http://localhost:3000/oi"===i?"oi":"chrome-extension:"!==A&&chrome?.runtime?.getURL?"cs":"localhost:3050"===e?"fg":"chrome-extension:"!==A?"nj":"/harpa.html"===t?"pp":"/offscreen.html"===t?"os":"bg"}})(),(()=>{const{$startup:e,$bus:t,$ai:i}=A;e.controller={async init(){await t.controller.init(),await i.controller.init(),t.on("startup.oiReady",(()=>!0)),e.logDev("oi ready")}},e.controller.init()})()})();