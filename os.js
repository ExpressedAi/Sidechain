(()=>{let e;var t;(()=>{const t="__app_hrp",r="production",n=!1;if(e=globalThis[t],e)return;const s={name:t,env:r,get:e=>e in s?s[e]:null,...JSON.parse('{"version":"9.2.1"}')},i=function e(t){const r=t===s,i=r&&n,l={},c=e=>Object.assign(t,e),u=new Proxy(t,{get(n,s){if("assign"===s)return c;if(r&&!String(s).startsWith("$"))return t[s];if(!(s in t)){if(t[s]={},r){const e=o.bind(null,"log",s,!1),r=o.bind(null,"log",s,!0),n=o.bind(null,"warn",s,!1),i=o.bind(null,"warn",s,!0),l=o.bind(null,"error",s,!1),c=o.bind(null,"error",s,!0),u=a.bind(null,s);Object.defineProperties(t[s],{log:{get:()=>e},logDev:{get:()=>r},warn:{get:()=>n},warnDev:{get:()=>i},error:{get:()=>l},errorDev:{get:()=>c},Error:{get:()=>u}})}l[s]=e(t[s]),i&&(globalThis[s]=t[s])}return s in l?l[s]:t[s]},set:(e,r,n)=>(t[r]=n,l[r]=n,i&&(globalThis[r]=t[r]),!0)});return u}(s);function o(e,t,r,...n){if(r)return;const[s,i,o]=function(e){let t=0;e.split("").forEach(((r,n)=>{t=e.charCodeAt(n)+((t<<5)-t)}));return[(16711680&t)>>16,(65280&t)>>8,255&t]}(t);console[e](`%c[${t}]`,`color: rgb(${s}, ${i}, ${o})`,...n)}function a(e,t,...r){return r.length>0&&o("error",e,!1,t,...r),new Error(`[${e}] ${t}`)}globalThis[t]=i,e=i})(),t=e=>crypto.getRandomValues(new Uint8Array(e)),e.$nanoid=(e=21)=>{let t="",r=crypto.getRandomValues(new Uint8Array(e));for(;e--;){let n=63&r[e];t+=n<36?n.toString(36):n<62?(n-26).toString(36).toUpperCase():n<63?"_":"-"}return t},e.$nanoid.customAlphabet=(e,r)=>((e,t,r)=>{let n=(2<<Math.log(e.length-1)/Math.LN2)-1,s=-~(1.6*n*t/e.length);return()=>{let i="";for(;;){let o=r(s),a=s;for(;a--;)if(i+=e[o[a]&n]||"",i.length===t)return i}}})(e,r,t),(()=>{const{$ai:t,$bus:r}=e;t.controller={init(){r.on("ai.countTextTokens",this._countTextTokens,this)},_countTextTokens:async(e,r)=>await t.tokenizer.countTextTokens(e,r)}})(),(()=>{const{$ai:t,$utils:r}=e;t.tokenizer={async countTextTokens(e,t){const n=this._ensureWorker(),s=r.id.nano();return await new Promise(((r,i)=>{const o=e=>{e.data&&e.data.resId===s&&(n.removeEventListener("message",o),r(e.data.tokens))};n.addEventListener("message",o),n.addEventListener("error",(e=>i(e))),n.postMessage({text:e,encoding:t,reqId:s})}))},_ensureWorker(){return this._worker||(this._worker=new Worker("/gpt-tokenizer.js")),clearTimeout(this._terminateWorkerTimer),this._terminateWorkerTimer=setTimeout((()=>{this._worker&&(this._worker.terminate(),this._worker=null)}),10*r.time.MINUTE),this._worker}}})(),(()=>{const{$chat:t}=e;t.paramSerp.toText=e=>{if("—"===e)return"—";const r=e.match(/<body[^>]*>([\s\S]*?)<\/body>/i);if(!r||!r[1])return"—";let n=r[1];n=n.replaceAll(/src="[^"]*"/g,"").replaceAll(/<style[^>]*>[\s\S]*?<\/style>/gi,"").replaceAll(/<script[^>]*>[\s\S]*?<\/script>/gi,"");let s=document.createElement("div");s.innerHTML=n,Array.from(s.querySelectorAll('script, style, img, svg, g-snackbar, g-inline-toggler, h2, cite, *[style="display:none"]')).forEach((e=>e.remove())),Array.from(s.querySelectorAll("g-section-with-header")).filter((e=>e.innerText.startsWith("Images for "))).forEach((e=>e.remove())),Array.from(s.querySelectorAll(".related-question-pair")).forEach((e=>e.remove())),Array.from(s.querySelectorAll("[role=button]")).filter((e=>!("SPAN"===e.tagName&&"wob_t"===e.getAttribute("class")&&"display:inline"===e.getAttribute("style")||e.getAttribute("data-q")||e.querySelector(".tdu-transportation-summary")))).forEach((e=>e.remove())),Array.from(s.querySelectorAll("*")).filter((e=>!e.textContent.trim())).forEach((e=>e.remove())),Array.from(s.querySelectorAll("*")).filter((e=>"true"===e.getAttribute("aria-hidden"))).forEach((e=>e.remove())),Array.from(s.querySelectorAll("[data-webbeat_link_prefix]")).forEach((e=>e.remove())),Array.from(s.querySelectorAll("*")).forEach((e=>{Array.from(e.attributes).filter((e=>"eid"!==e.name&&("href"!==e.name||e.value.startsWith("/")))).forEach((t=>e.removeAttribute(t.name)))}));const i=Array.from(s.querySelectorAll("h3, [eid]")).filter((e=>!e.closest('[role="alertdialog"]')));if(s=t.paramSerp.findCommonParent(Array.from(i)),!s)return"—";i.filter((e=>"A"===e.parentNode.tagName&&e.parentNode.getAttribute("href"))).forEach(((e,t)=>{let r=e.parentNode.getAttribute("href");r=(r||"").split("#:~:")[0];const n=e.textContent.trim();e.textContent=`### ${n} [${t+1}](${r})`})),document.body.appendChild(s);let o=s.innerText.split("\n");document.body.removeChild(s),o=o.map((e=>e.trim())).filter(((e,t,r)=>e&&r.indexOf(e)===t));const a=["Top stories"];o=o.map((e=>a.some((t=>e.startsWith(t)))?`### ${e}`:e));const l=["Search Results","People also search for","People also ask","Update Map Image","Choose what you’re giving feedback on","Or give general feedback","general feedback","Description","View all","Get there","More news","See more","About featured snippets"];if(o=o.filter((e=>!l.includes(e))),o.length>=2&&!o[0].startsWith("#")){const e=o[0];o[0]=o[1],o[1]=e}return o=o.join("\n").replace(/ +/g," ").trim(),o},t.paramSerp.findCommonParent=e=>{if(0===e.length)return null;if(1===e.length)return e[0].parentNode;let t=e[0];for(;t.parentNode;)if(t=t.parentNode,e.slice(1).every((e=>t.contains(e))))return t;return null}})(),(()=>{const{$chat:t}=e;t.paramYouTubeTranscript.getTranscript=async e=>{try{const t=await fetch(e,{credentials:"include"}),r=await t.text(),n=r.split("ytInitialPlayerResponse =")[1].split(";var")[0].split(";<\/script>")[0];let s=JSON.parse(n)?.captions?.playerCaptionsTracklistRenderer?.captionTracks;if(!s){const t=r.split('XSRF_TOKEN":"')[1].split('"')[0],n=JSON.parse(`"${t}"`),i=Math.floor(Date.now()/1e3)+3e3,o=`https://www.youtube.com/watch?v=${new URL(e).searchParams.get("v")}&bpctr=${i}&pbj=1`,a=await fetch(o,{method:"POST",headers:{"content-type":"application/x-www-form-urlencoded"},body:`session_token=${encodeURIComponent(n)}`,credentials:"include"}),l=await a.text(),c=JSON.parse(l)?.playerResponse;s=c?.captions?.playerCaptionsTracklistRenderer?.captionTracks}if(!s)return{transcript:null};const i=s.find((e=>e.vssId.startsWith(".en")))||s.find((e=>"a.en"===e.vssId))||s[0];if(!i)return{transcript:null};const o=i.baseUrl.startsWith("/")?`https://www.youtube.com${i.baseUrl}`:i.baseUrl,a=await fetch(o,{credentials:"include"}),l=await a.text(),c=document.createElement("div");c.innerHTML=l;const u=[...c.querySelectorAll("text")];return{transcript:u.map((e=>({s:parseFloat(e.getAttribute("start")),d:parseFloat(e.getAttribute("dur")),t:e.innerText.replace(/<\/?[^>]+(>|$)/g,"").replaceAll("&#39;","'").replaceAll("&quot;",'"').replaceAll("\n"," ")})))}}catch(e){return{transcript:null,error:e.message||String(e)}}}})(),(()=>{const{$chat:t,$bus:r}=e;t.controller={init(){r.on("chat.paramSerp.toText",((...e)=>t.paramSerp.toText(...e))),r.on("chat.paramYouTubeTranscript.getTranscript",((...e)=>t.paramYouTubeTranscript.getTranscript(...e)))}}})(),(()=>{const{$engine:t,$bus:r,$env:n}=e;t.htmlToText=async e=>{if(n.is.bg)return await r.send("engine.htmlToText",e);if(!e)return e;const t=e.match(/<body[^>]*>([\s\S]*?)<\/body>/i);if(!t||!t[1])return null;let s=t[1];s=s.replaceAll(/src="[^"]*"/g,"").replaceAll(/href="[^"]*"/g,""),s=s.replaceAll(/<style[^>]*>[\s\S]*?<\/style>/gi,"").replaceAll(/<script[^>]*>[\s\S]*?<\/script>/gi,"");let i=document.createElement("div");i.innerHTML=s;Array.from(i.querySelectorAll("head, script, style, img, svg, nav, footer, header, aside, iframe, video, audio, canvas, map, object, embed, applet, frame, frameset, noframes, noembed, noscript, link, meta, base, title")).forEach((e=>e.remove())),Array.from(i.querySelectorAll("*")).filter((e=>!e.textContent.trim())).forEach((e=>e.remove())),Array.from(i.querySelectorAll("*")).forEach((e=>{Array.from(e.attributes).forEach((t=>e.removeAttribute(t.name)))})),i.querySelectorAll("h1, h2, h3, h4, h5, h6").forEach((e=>{const t=parseInt(e.tagName[1]);e.textContent="#".repeat(t)+` ${e.textContent}`})),document.body.appendChild(i);let o=i.innerText||"";return document.body.removeChild(i),o=o.replace(/ +/g," ").replace(/\n+/g,"\n").trim(),o=o.split("\n").map((e=>e.trim())),o=o.filter(((e,t)=>e&&o.indexOf(e)===t)).join("\n"),o}})(),(()=>{const{$engine:t,$bus:r}=e;t.controller={init(){r.on("engine.htmlToText",t.htmlToText)}}})(),(()=>{const{$offscreen:t}=e;t.controller={init(){t.iframeController.init(),t.imageController.init(),t.utilsController.init()}}})(),(()=>{const{$offscreen:t,$bus:r,$env:n,$utils:s}=e;t.iframeController={init(){this._src=`${n.webUrl}/oi`,this._iframe=this._createIframe(),r.setIframe(this._iframe),this._manageIframeStability().then((()=>{}))},_createIframe(){const e=document.createElement("iframe");return e.src=this._src,e.name=`offscreen-iframe | ${chrome.runtime.getURL("/oi.js")}`,document.body.append(e),e},async _manageIframeStability(){navigator.onLine||(t.log("waiting for online..."),await new Promise((e=>{const t=()=>{navigator.onLine&&(navigator.connection.removeEventListener("change",t),e())};navigator.connection.addEventListener("change",t)})),this._iframe.src=this._src);const e=async(r=0)=>{if(await this._pingIframe())return;const n=r<4?3:60;t.log(`failed to start oi, trying again in ${n}s...`),await s.sleep(n*s.time.SECOND),this._iframe.src=this._src,await e(r+1)};await e(),setInterval((async()=>{await this._pingIframe()||(t.log("failed to ping oi, restarting..."),this._iframe.src=this._src)}),5*s.time.MINUTE)},_pingIframe:async()=>await Promise.race([r.poll("startup.oiReady").then((()=>!0)),s.sleep(5e3).then((()=>!1))])}})(),(()=>{const{$offscreen:t,$bus:r,$utils:n}=e;t.imageController={init(){r.on("offscreen.svgToImage",this._svgToImage,this),r.on("offscreen.createImagePreview",this._createImagePreview,this)},async _svgToImage({svgCode:e,width:t,height:r,dpr:s,quality:i}){const o=new Blob([e],{type:"image/svg+xml"}),a=await new Promise(((e,t)=>{const r=new FileReader;r.onerror=t,r.onload=()=>e(r.result),r.readAsDataURL(o)})),l=document.createElement("img");await new Promise(((e,t)=>{l.src=a,l.onload=e,l.onerror=()=>t("failed to load svg data url")}));const c=document.createElement("canvas"),u=c.getContext("2d");c.width=t*s,c.height=r*s,u.fillStyle="#fff",u.fillRect(0,0,c.width,c.height),u.drawImage(l,0,0,t,r,0,0,c.width,c.height);const h=await n.canvasToBlob(c,"image/webp",i);return URL.createObjectURL(h)},async _createImagePreview(e){const t=document.createElement("img"),r=URL.createObjectURL(e);t.src=r,await new Promise(((e,r)=>{t.onload=e,t.onerror=r}));const s=document.createElement("canvas");let i,o;s.width=660,s.height=462;const a=t.naturalWidth,l=t.naturalHeight,c=a/l,u=s.width/s.height;c<u?(i=a,o=a/u):(o=l,i=l*u);return s.getContext("2d").drawImage(t,0,0,i,o,0,0,s.width,s.height),await n.canvasToBlob(s,"image/webp",.5)}}})(),(()=>{const{$offscreen:t,$utils:r,$bus:n}=e;t.utilsController={init(){const e=r.ls;n.on("utils.ls.get",e.get,e),n.on("utils.ls.set",e.set,e),n.on("utils.ls.has",e.has,e),n.on("utils.ls.remove",e.remove,e);const t=r.objectUrl;n.on("utils.objectUrl.create",t.create,t),n.on("utils.objectUrl.revoke",t.revoke,t)}}})(),(()=>{const{$runner:t,$bus:r,$utils:n}=e;t.audioController={init(){this._synth=window.speechSynthesis,this._sounds={},this._voices={},this._setupVoices(),this._notifyVoicesChanged(),r.on("runner.audio.loadSrc",this._loadSrc,this),r.on("runner.audio.playSrc",this._playSrc,this),r.on("runner.audio.playVoice",this._playVoice,this),r.on("runner.audio.stopVoice",this._stopVoice,this),r.on("runner.audio.getVoices",this._getVoices,this)},_setupVoices(){const e=()=>{for(const e of this._synth.getVoices())this._voices[e.name]=e};e(),this._synth.addEventListener("voiceschanged",e)},_notifyVoicesChanged(){this._synth.addEventListener("voiceschanged",(()=>{r.send("runner.audio.vocesChanged")}))},_loadSrc(e){this._sounds[e]=new Audio(e)},_playSrc(e,t){const r=this._sounds[e];r&&(r.pause(),r.currentTime=0,setTimeout((()=>{r.volume=t,r.play()})))},_playVoice(e,t,r){this._synth.cancel(),setTimeout((()=>{const s=new window.SpeechSynthesisUtterance;s.text=n.clearFromTags(r),s.voice=this._voices[e],s.volume=t,this._synth.speak(s)}))},_stopVoice(){this._synth.cancel()},_getVoices(){return this._synth.getVoices().map((e=>{const t={};for(const r in e)t[r]=e[r];return t}))}}})(),(()=>{const{$runner:t}=e;t.controller={init(){t.audioController.init()}}})(),(()=>{const{$timer:t,$bus:r}=e;t.aliveController={init(){this._keepBgAlive()},_keepBgAlive(){setInterval((()=>r.send("timer.keepBgAlive")),2e4)}}})(),(()=>{const{$timer:t}=e;t.controller={init(){t.aliveController.init(),t.timingController.init(),t.workerController.init()}}})(),(()=>{const{$timer:t,$bus:r}=e;t.timingController={init(){this._timerIds=new Set,this._intervalsById={},r.on("timer.setTimeout",this._setTimeout,this),r.on("timer.clearTimeout",this._clearTimeout,this),r.on("timer.setInterval",this._setInterval,this),r.on("timer.clearInterval",this._clearInterval,this)},hasTimers(){return this._timerIds.size>0},async _setTimeout(e,t){this._timerIds.add(e),await new Promise((r=>{setTimeout((()=>{this._timerIds.delete(e),r()}),t)}))},_clearTimeout(e){this._timerIds.delete(e)},_setInterval(e,t){this._timerIds.add(e),this._intervalsById[e]=setInterval((()=>{r.send(`timer.setIntervalCall:${e}`)}),t)},_clearInterval(e){this._timerIds.delete(e),clearInterval(this._intervalsById[e]),delete this._intervalsById[e]}}})(),(()=>{const{$timer:t}=e;t.workerController={init(){this._MAX_ID=2147483647,this._lastId=0,this._idToCallback={},this._setupWorker("/js/timer-worker.min.js")},_generateId(){do{this._lastId===this._MAX_ID?this._lastId=0:this._lastId++}while(this._idToCallback.hasOwnProperty(this._lastId));return this._lastId},_setupWorker(e){const r=this._idToCallback;try{const n=new Worker(e);window.setInterval=(e,t)=>{const s=this._generateId();return r[s]={callback:e,parameters:Array.prototype.slice.call(arguments,2)},n.postMessage({name:"setInterval",id:s,time:t}),s},window.clearInterval=e=>{r.hasOwnProperty(e)&&(delete r[e],n.postMessage({name:"clearInterval",id:e}))},window.setTimeout=(e,t)=>{const s=this._generateId();return r[s]={callback:e,parameters:Array.prototype.slice.call(arguments,2),isTimeout:!0},n.postMessage({name:"setTimeout",id:s,time:t}),s},window.clearTimeout=e=>{r.hasOwnProperty(e)&&(delete r[e],n.postMessage({name:"clearTimeout",id:e}))},n.onmessage=e=>{const n=e.data.id;if(!n||!r.hasOwnProperty(n))return;const s=r[n],i=s.parameters;let o=s.callback;if(s.isTimeout&&delete r[n],"string"==typeof o)try{o=new Function(o)}catch(e){t.error("error parsing callback code string",e)}"function"==typeof o&&o.apply(window,i)},n.onerror=e=>{t.error("worker posted an error event",e)}}catch(e){t.error("failed setting up timer worker",e)}}}})(),(()=>{const{$utils:t}=e;t.canvasToBlob=async(e,t="image/webp",r=.9)=>await new Promise(((n,s)=>{try{e.toBlob((t=>{t?n(t):0===e.width||0===e.height?s("canvas.toBlob failed, canvas has no dimensions"):s("canvas.toBlob failed")}),t,r)}catch(e){s(e)}}))})(),(()=>{const{$utils:t}=e;t.clearFromTags=e=>e?(t.is.string(e)||(e=String(e)),e.replaceAll(/<\w+>/g,"").replaceAll(/<\/\w+>/g,"").replaceAll(/<\w+\/>/g,"")):e})(),(()=>{const{$utils:t}=e;t.createPromise=()=>{let e=null,t=null;const r=new Promise(((r,n)=>{e=r,t=n}));return Object.defineProperty(r,"resolve",{get:()=>e}),Object.defineProperty(r,"reject",{get:()=>t}),r}})(),(()=>{const{$utils:t,$nanoid:r}=e;t.id={pico(e=[]){const t="0123456789abcdefghijklmnopqrstuvwxyz";if(e.length>=t.length**4)throw new Error("Cannot generate more IDs");let r;do{r="";for(let e=0;e<4;e++){const e=Math.floor(Math.random()*t.length);r+=t.charAt(e)}}while(e.includes(r));return r},nano(e=[]){let t;do{t=r()}while(e.includes(t));return t},uuid(e=[]){let t;do{t=crypto.randomUUID()}while(e.includes(t));return t}}})(),(()=>{const{$utils:t}=e;t.is={null:e=>null===e,defined:e=>void 0!==e,undefined:e=>void 0===e,nil:e=>null==e,boolean:e=>"boolean"==typeof e,number:e=>"number"==typeof e,string:e=>"string"==typeof e,symbol:e=>"symbol"==typeof e,function:e=>"function"==typeof e,map:e=>e instanceof Map,set:e=>e instanceof Set,url:e=>e instanceof URL,blob:e=>e instanceof Blob,file:e=>e instanceof File,error:e=>e instanceof Error,regexp:e=>e instanceof RegExp,array:e=>Array.isArray(e),object:e=>"[object Object]"===Object.prototype.toString.call(e),nan:e=>Number.isNaN(e),nonPrimitive:e=>t.is.object(e)||t.is.array(e),numeric:e=>!t.is.nan(Number(e)),empty:e=>!!t.is.nil(e)||(t.is.array(e)?0===e.length:t.is.object(e)?0===Object.keys(e).length:!!t.is.string(e)&&0===e.trim().length)}})(),(()=>{const{$utils:t,$bus:r}=e;t.ls={get(e,t){if(!this._supported())return r.send("utils.ls.get",e,t);if(!this.has(e))return t;const n=localStorage.getItem(e);if("undefined"===n)return;if("null"===n)return null;if("true"===n)return!0;if("false"===n)return!1;if(n.startsWith("[")||n.startsWith("{"))return JSON.parse(n);const s=Number(n);return Number.isNaN(s)?n:s},set(e,t){if(!this._supported())return r.send("utils.ls.set",e,t);try{"string"==typeof t?localStorage.setItem(e,t):localStorage.setItem(e,JSON.stringify(t))}catch(r){console.error("$utils.ls.set failed to store the given value",{key:e,value:t,error:r})}},has(e){return this._supported()?e in localStorage:r.send("utils.ls.has",e)},remove(e){if(!this._supported())return r.send("utils.ls.remove",e);localStorage.removeItem(e)},_supported:()=>!!globalThis.localStorage}})(),(()=>{const{$utils:t,$bus:r}=e;t.objectUrl={create(e,n=!1){if(!URL.createObjectURL)return r.send("utils.objectUrl.create",e,n);const s=URL.createObjectURL(e);if(n){const e=t.is.number(n)?n:6e4;setTimeout((()=>URL.revokeObjectURL(s)),e)}return s},revoke(e){if(!URL.revokeObjectURL)return r.send("utils.objectUrl.revoke",e);URL.revokeObjectURL(e)}}})(),Array.prototype.toReversed&&(Array.prototype.toReversed=function(){return[...this].reverse()}),Array.prototype.at||(Array.prototype.at=function(e){return this[e>=0?e:this.length+e]}),Array.prototype.findLastIndex||(Array.prototype.findLastIndex=function(e,t){for(let r=this.length-1;r>=0;r--)if(e.call(t,this[r],r,this))return r;return-1}),String.prototype.replaceAll&&/\{\s+\[native code]/.test(Function.prototype.toString.call(String.prototype.replaceAll))||(String.prototype.replaceAll=function(e,t){return"[object regexp]"===Object.prototype.toString.call(e).toLowerCase()?this.replace(e,t):this.replace(new RegExp(e,"g"),t)}),(()=>{const{$utils:t}=e;t.sleep=async e=>new Promise((t=>{setTimeout(t,e)}))})(),(()=>{const{$utils:t}=e,r=36e5,n=24*r,s=365*n,i=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],o=e=>{if(!e)return null;if("string"==typeof e)return"string";const t=new Date;if(e>t.getTime()){if(t.setHours(0,0,0,0),e<=t.getTime()+n)return"today";if(e<=t.getTime()+2*n)return"tomorrow";if(t.setHours(23,59,59,999),t.setMonth(11,31),e<=t)return"year"}else{if(t.setHours(0,0,0,0),e>=t.getTime())return"today";if(e>=t.getTime()-n)return"yesterday";if(t.setMonth(0,1),e>=t.getTime())return"year"}return"other"};t.time={SECOND:1e3,MINUTE:6e4,HOUR:r,DAY:n,WEEK:6048e5,MONTH:26784e5,YEAR:s,MILLENNIUM:31536e9,months:i,fullMonths:["January","February","March","April","May","June","July","August","September","October","November","December"],relativeDateType:o,formatTime:(e,t)=>(t=t||{hour12:!1,timeZone:"UTC"},(e=(e=e||new Date)instanceof Date?e:new Date(e)).toLocaleTimeString("en-UK",t)),formatDate:(e,t)=>e?(e=e instanceof Date?e:new Date(e),t={day:"numeric",month:"short",year:"numeric",hour12:!1,...t},0===e.getUTCHours()&&0===e.getUTCMinutes()&&0===e.getUTCSeconds()?e.toLocaleDateString("en-UK",t):e.toLocaleTimeString("en-UK",t)):null,formatRelativeDate:(e,t=!1)=>{if(!e)return null;const r=o(e);if("string"===r)return e;function n(e){return e<10?`0${e}`:e}const s=new Date(e),a=(!t||0!==s.getHours()||0!==s.getMinutes())&&`${n(s.getHours())}:${n(s.getMinutes())}`;if("tomorrow"===r)return a?`Tomorrow ${a}`:"Tomorrow";if("today"===r)return a?`${a}, Today`:"Today";if("yesterday"===r)return a?`Yesterday ${a}`:"Yesterday";const l=s.getDate(),c=i[s.getMonth()];if("year"===r)return a?`${l} ${c} ${a}`:`${l} ${c}`;const u=s.getFullYear();return"other"===r?a?`${l} ${c} ${u}, ${a}`:`${l} ${c} ${u}`:e},formatDuration:e=>{if(0===e)return"0s";const t=Math.abs(e/1e3);let r=1e3*t%1e3;r=r&&`${r}ms`;let n=Math.floor(t%60);n=n&&`${n}s`;let s=Math.floor(t/60)%60;s=s&&`${s}m`;let i=Math.floor(t/3600)%24;i=i&&`${i}h`;let o=Math.floor(t/86400);return o=o&&`${o}d`,[o,i,s,n,r].filter((e=>Boolean(e))).join(" ")},frequencyToMs:e=>{const r={s:t.time.SECOND,m:t.time.MINUTE,h:t.time.HOUR,d:t.time.DAY,w:t.time.WEEK,mo:t.time.MONTH},n=parseInt(e.match(/\d+/));if(!n)return 0;const s=r[e.match(/\D+/)]||0;return s&&n*s||0},startOfDayGmt0:()=>new Date((new Date).setUTCHours(0,0,0,0)),since:e=>Date.now()-Number(e)}})(),(()=>{const{$utils:t}=e;t.versionNumber=e=>{e=e||"0.0.0";const[t,r,n]=e.split(".");return 1e6*(Number(t)||0)+1e3*(Number(r)||0)+(Number(n)||0)}})(),(()=>{const{$utils:t}=e;t.waitFor=async(e,{interval:r=100,timeout:n=6e4}={})=>{if(n<=0)throw new Error("$utils.waitFor: timeout exceeded");const s=Date.now(),i=await e();if(i)return i;await t.sleep(r);const o=Date.now()-s;return t.waitFor(e,{interval:r,timeout:n-o})}})(),(()=>{const{$bus:t,$env:r,$utils:n}=e;{const t=e.get("$bus").controller?._njOnMsg;t&&window.removeEventListener("message",t)}t.controller={init(){t.on=this.on.bind(this),t.off=this.off.bind(this),t.once=this.once.bind(this),t.send=this._wrapThrowIfError(this.send),t.call=this._wrapThrowIfError(this.call),t.poll=this.poll.bind(this),t.getTabId=this.getTabId.bind(this),t.getWindowId=this.getWindowId.bind(this),this._locus=r.getLocus(),this._serialize=this._serialize.bind(this),this._handlers={},this._is("pp")?this._setupPp():this._is("bg")?(this._blobs={},this._channel=new BroadcastChannel("bus.channel"),this._setupBg()):this._is("cs")?this._setupCs():this._is("nj")?this._setupNj():this._is("os")?(t.setIframe=e=>this._iframe=e,this._iframe=null,this._channel=new BroadcastChannel("bus.channel"),this._setupOs()):this._is("oi")&&this._setupOi()},on(e,t,r=null){this._on(e,null,t,r)},off(e,t=null){this._off(e,null,t)},once(e,t){const r=async(...n)=>(this.off(e,r),await t(...n));this.on(e,r)},async send(e,...r){if(!n.is.nan(Number(e))){const t=Number(e);return e=r[0],r=r.slice(1),await this._sendToTab(t,e,...r)}if(this._is("pp"))return await this._sendToExt(e,...r);if(this._is("nj"))return await this._sendToPage(e,...r);if(this._is("oi"))return await this._sendToParent(e,...r);if(this._is("bg","cs","os"))return await this._pick([this._sendToExt(e,...r),this._callHandlers({name:e,args:r},(e=>e.proxy))]);if(this._is("fg")){if("store.actions"===e)return;if("idb.change"===e)return;t.log(e,...r)}},async call(e,...t){return this._callHandlers({name:e,args:t},(e=>!e.proxy))},async poll(e,...t){return await n.waitFor((()=>this.send(e,...t)))},async getTabId(){if(this._is("bg"))return null;const{tabId:e}=await this.send("bus.getTabData");return e},async getWindowId(){if(this._is("bg"))return null;const{windowId:e}=await this.send("bus.getTabData");return e},_on(e,t,r,n=null){this._handlers[e]||(this._handlers[e]=[]),this._is("cs","nj","oi")&&0===this._handlers[e].length&&this._sendToProxier("bus.proxy",e,!0);const s={fn:r,name:e};t&&(s.proxy=t),n&&(s.this=n),this._handlers[e].push(s)},_off(e,t=null,r=null){this._handlers[e]&&(this._handlers[e]=this._handlers[e].filter((e=>{const n=!r||r===e.fn,s=t===(e.proxy||null);return!n||!s})),this._is("cs","nj","oi")&&0===this._handlers[e].length&&this._sendToProxier("bus.proxy",e,!1))},_setupPp(){},_setupBg(){},_setupCs(){},_setupNj(){},_setupOs(){chrome.runtime.onMessage.addListener(((e,t,r)=>{if(!e?.$bus)return;const n=this._callHandlers(e);return n?(n.then(this._serialize).then(r),!0):void 0})),window.addEventListener("message",(async({data:e})=>{if(!e?.$bus)return;if("bus.proxy"===e.name){const[t,r]=e.args;return void(r?this._on(t,"oi",((...e)=>this._sendToIframe(t,...e))):this._off(t,"oi"))}const t=await this._pick([this._sendToExt(e.name,...e.args),this._callHandlers(e,(e=>!e.proxy))]);this._iframe.contentWindow.postMessage({resId:e.reqId,result:t},"*")})),this._channel.addEventListener("message",(({data:e})=>{const{blob:t,reqId:r}=e,s=n.objectUrl.create(t,!0);this._channel.postMessage({resId:r,objectUrl:s})}))},_setupOi(){},async _sendToExt(e,...r){const n={$bus:!0,name:e,argsStr:this._serialize(r)},s=await new Promise((e=>{try{chrome.runtime.sendMessage(n,(t=>{chrome.runtime.lastError?e(null):e(t)}))}catch(r){if("Extension context invalidated."===r.message)return;t.error(r),e(null)}}));return await this._deserialize(s)},async _sendToTab(e,t,...r){if(!chrome.tabs?.sendMessage)return await this.send("bus.sendToTab",e,t,...r);const n={$bus:!0,name:t,argsStr:this._serialize(r)},s=await new Promise((t=>{chrome.tabs.sendMessage(e,n,(e=>{chrome.runtime.lastError?t(null):t(e)}))}));return await this._deserialize(s)},async _sendToPage(e,...t){const r=this._generateId(),n={$bus:!0,name:e,args:t,reqId:r,locus:this._locus};return window.postMessage(n,"*"),await this._waitForResponseMessage(r)},async _sendToIframe(e,...t){if(!this._iframe)return null;const r=this._generateId(),n={$bus:!0,name:e,args:t,reqId:r};return this._iframe.contentWindow.postMessage(n,"*"),await this._waitForResponseMessage(r)},async _sendToParent(e,...t){const r=this._generateId(),n={$bus:!0,name:e,args:t,reqId:r};return parent.postMessage(n,"*"),await this._waitForResponseMessage(r)},async _sendToProxier(e,...t){return this._is("cs")?await this._sendToExt(e,...t):this._is("nj")?await this._sendToPage(e,...t):this._is("oi")?await this._sendToParent(e,...t):void 0},_waitForResponseMessage:async e=>await new Promise((t=>{const r=({data:n})=>{!(!n||n.resId!==e)&&(window.removeEventListener("message",r),t(n.result))};window.addEventListener("message",r)})),_callHandlers({name:e,args:r,argsStr:n},s=null){let i=this._handlers[e];return i?(s&&(i=i.filter(s)),0===i.length?null:new Promise((async e=>{n&&(r=await this._deserialize(n));e(await this._pick(i.map((async e=>{try{return await e.fn.call(e.this,...r)}catch(r){return t.error(`failed to handle "${e.name}".`,r),r}}))))}))):null},_serialize(e){return n.is.nil(e)?null:JSON.stringify(e,((e,t)=>{if(n.is.blob(t)){if(this._is("bg")){const e=this._generateId();return this._blobs[e]=t,`bus.blob.${e}`}return`bus.blob.${n.objectUrl.create(t,!0)}`}return n.is.error(t)?`bus.error.${t.message}`:t}))},async _deserialize(e){if(!n.is.string(e))return null;const t=new Map,r=JSON.parse(e,((e,r)=>{const s=n.is.string(r);return s&&r.startsWith("bus.blob.")?(t.set(r,r.slice("bus.blob.".length)),r):s&&r.startsWith("bus.error.")?new Error(r.slice("bus.error.".length)):r}));return await Promise.all([...t.keys()].map((async e=>{let r;const n=t.get(e);r=n.startsWith("blob:")?n:await this._sendToExt("bus.blobIdToObjectUrl",n);const s=await fetch(r).then((e=>e.blob()));t.set(e,s)}))),this._applyBlobs(r,t)},_applyBlobs(e,t){if(t.has(e))return t.get(e);if(n.is.array(e)||n.is.object(e))for(const r in e)e[r]=this._applyBlobs(e[r],t);return e},async _blobIdToObjectUrl(e){},async _blobToObjectUrl(e){},_is(...e){return e.includes(this._locus)},_generateId:()=>`bus-${Date.now()}-${Math.random().toString(36).slice(2)}`,_wrapThrowIfError(e){return async(...t)=>{const r=await e.call(this,...t);if(n.is.error(r))throw r;return r}},_pick:async(e=[])=>0===e.length?null:await new Promise((t=>{let r=0;e.forEach((async s=>{const i=await s;return n.is.nil(i)?r===e.length-1?t(null):void r++:t(i)}))}))}})(),(()=>{const{$env:t}=e;t.getLocus=()=>{if("undefined"==typeof location)return"el";const{protocol:e,host:t,pathname:r,href:n}=location;return"https://harpa.ai/oi"===n||"http://localhost:3000/oi"===n?"oi":"chrome-extension:"!==e&&chrome?.runtime?.getURL?"cs":"localhost:3050"===t?"fg":"chrome-extension:"!==e?"nj":"/harpa.html"===r?"pp":"/offscreen.html"===r?"os":"bg"}})(),(()=>{const{$env:t,$utils:r}=e;t.controller={async init(){const n=t.getLocus(),s="el"===n?"desktop":"extension",i="el"===n?e.env:await r.ls.get("env.is")||e.env;Object.assign(t,{env:i,locus:n,version:e.version,versionNumber:r.versionNumber(e.version),platform:this._getPlatform(),webUrl:"https://harpa.ai",apiUrl:"https://api.harpa.ai/api/v1",jwtCookieDomain:"harpa.ai",makeAppInviteUrl:"https://www.make.com/en/hq/app-invitation/c98499c16cfa22f1051f64346ef91aaa",extReviewUrl:"https://chromewebstore.google.com/detail/harpa-ai-automation-agent/eanggfilgoajaocelnaflolkadkeghjp/reviews",mixpanel:{token:"7958323a20a869de3c57712bfe521a6f"},contactEmail:"support@harpa.ai",discordUrl:"https://discord.gg/B9Evx82m4K",showWelcomeOnUpdate:!0,is:{pp:"pp"===n,bg:"bg"===n,el:"el"===n,cs:"cs"===n,nj:"nj"===n,os:"os"===n,fg:"fg"===n,test:"test"===i,beta:"beta"===i,production:"production"===i,development:"development"===i,desktop:"desktop"===s,extension:"extension"===s},features:await this._initFeatures({debug:"development"===i||"beta"===i,taskImport:!0,taskExport:!0,library:!1,changesTracking:!1,actionsReporting:!1,doubleCheck:!1,emailActionFromField:!1}),options:{}});await r.ls.get("$env.useDevServer")&&(t.log("using dev server"),Object.assign(t,{webUrl:"http://localhost:3000",apiUrl:"http://localhost:3010/api/v1",jwtCookieDomain:"localhost"})),Object.assign(t,{welcomeUrl:`${t.webUrl}/welcome`,contactUsUrl:`${t.webUrl}/#contact-us`,jwtCookieUrl:t.webUrl}),"development"===i&&(t.dev=this.useDevServer.bind(this))},async useDevServer(e=!0){e?await r.ls.set("$env.useDevServer",!0):await r.ls.remove("$env.useDevServer")},async _initFeatures(e={}){const t={};for(const n in e)t[n]=await r.ls.get(`$env.features.${n}`,e[n]);return t},_getPlatform(){const e=navigator.platform.toLowerCase();return e.startsWith("mac")?"mac":e.startsWith("linux")?"linux":"win"}}})(),(()=>{const{$startup:t,$ai:r,$bus:n,$chat:s,$engine:i,$env:o,$offscreen:a,$runner:l,$timer:c}=e;t.controller={async init(){await n.controller.init(),await o.controller.init(),await c.controller.init(),await r.controller.init(),await s.controller.init(),await i.controller.init(),await l.controller.init(),await a.controller.init(),n.on("startup.osReady",(()=>!0)),t.logDev("os ready")}},t.controller.init()})()})();